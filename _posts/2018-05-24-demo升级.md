---
title: demo升级
date: 2018-05-24
categories: android
tags:
- 注解
---

昨天做的那个demo其实还是有点问题的，昨天的时候还没发现，今天升级的时候才发现，这个后面再说。

今天做个升级版，就是将URL中的key信息提取出来，直接绑定到被启动的AC的成员变量中，当然暂时只支持String，后面考虑下加入对可序列化对象的支持。

<!---begin--->


因为之前写的那个demo是将所有信息写在同一个类中，而且我不知道processor会调用几次，所以我的写法是用一个静态的StringBuilder 来存储映射插入的信息，一个类调用就将映射代码加到StringBuilder中，然后将剩下的代码和添加映射代码组合，写到类中。
那天我简单演示的时候还没问题，因为我那时候只绑定了一个。升级的时候发现绑定2个的时候死活只有一个绑定了。
但是又陷入了昨天的尴尬，调试不了，不能Log，不能sout，后面我发现了一个神奇的方法，就是在再用一个StringBuilder，将调试的信息存起来，然后以注释的形式写到类中，这不就能查看了吗？
但是后面的问题更让人费解，我Processor中遍历获取注释的Set，然后生成 添加映射代码， 我就用builder计数，看看我这个set到底有多长。然后注释出来是1。惊了，这不科学，我在网上查找，获取注释都是这样的，为什么我不能获取完整的注释！长度只有1，只能绑定一个？
后面硬是看了processor的原理才知道，原来processor只运行一次，而且编译时注解只能生成类，不能更改类，所以我每遍历一个注解就写一次这种方法是不行的，当第二次的时候生成的代码就写不进去了，记了数也不能写进去。后面解决这个问题之后就很快写完了，大概用了一个下午左右的时间。

至于早上的时间我在看 “跳板” 类的源码，现在总结起来也很简单。一个图说清楚。
![流程](https://raw.githubusercontent.com/neo1946/neo1946.github.io/master/assets/images/3.jpg)
简单来说就是通过URL获取Action，然后再根据Action获取到不同的info，对应不同的启动逻辑，然后跳板类再调用这个info启动ac。

重点是这个info有不同的逻辑，举个例子，如果某个页面要求登陆，如果没有登陆他就要求登陆。如果用注解生成代替的话会导致一些问题。
![流程](https://raw.githubusercontent.com/neo1946/neo1946.github.io/master/assets/images/4.jpg)
1、如果这个生成逻辑是由注解自动生成的话，那启动逻辑应该是由A的注解生成还是B的注解生成。
2、程序的调用思路是从左到右，编写的时候是从右到左，先写每个页面，再写应该怎样启动他们。但是如果用注解生成的方式会变成你在写这个页面的时候需要提前知道什么时候调用它，谁会调用它，它和其他页面的关系。这些再技术上能不能做另说，但是完全违背了面向对象的解耦。
3、每个启动逻辑都不一样，每个逻辑都只用一次生成的话，注解就起不到自动化，批量化生成的特点。

所以还是有点困惑，明天再去问问导师。


