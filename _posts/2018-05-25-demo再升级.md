---
title: demo再升级
date: 2018-05-25
categories: android
tags:
- 注解
---

今天导师还没来的时候想了一下这个demo，一开始想加入一个功能。就是绑定时候检查添加的类是不是Activity，但是想到这个可能会造成性能问题，然后去做了一下性能测试，后面发现初始化时候消耗确实不小，就想了一下怎么优化。

<!---begin--->


原来是方案①。 加入检查是方案②，优化是方案③。
①初始化的时候插入URL和类，这个类是通过全限定类名获得的。
②初始化的时候插入URL和类，而且通过类名获取实例，再循环递归检查是否Activity的子类。
③初始化的时候插入URL和全限定类名。
下面是测试数据。
![测试数据](https://raw.githubusercontent.com/neo1946/neo1946.github.io/master/assets/images/5.png)
如果是方案2的话我算了一下固定时间是2000μs左右，然后每绑定一个AC大概用时1.345ms，所以在比较大的项目，动辄几百个Activity或者Fragment的这种，初始化时间直逼1秒，卡顿的难以接受。
方案三的话就好很多了，就算绑定1000个AC，也是400ms左右，耗时大概是方案2的3到4分之一。而且这个方案还有优点，内存占用少，因为是用类的静态成员实现存储，存储一个类和存储一个字符串差别还是很大的。
对了，这里补一句，这是在我的红米手机上做的测试，以现在主流手机的性能，就算是上千个Ac应该也不会超过200ms。

然后下午就是对这个demo再次进行升级，增加了对Fragment的支持，这个也不算太难，但是因为我用Fragment用得比较少，不知道怎么在启动的时候添加参数，所以请教了一下导师。但是后面又遇到了一个问题，就是注解器不知道这个类到底是Fragment还是Activity，然后他们获取的方法还不一样，一开始想在获取类中用instanceof判断，然后写不同的获取方法，但是这也有问题，就算代码就算不会运行也会报错，你在一个else语句中对Fragment类getIntent直接就报错。
后面只能分开2种注解，一种注解AC，一种注解Fragment。

然后下午后半部分又升了一次级，就是增加对Parcelable对象的支持，也就是说不仅仅能通过URL中的参数传到目标类成员中，还能在启动的时候添加Parcelable对象，传到目标类成员中。还修改了启动方法，用builder的方式能多次add对象。
![](https://raw.githubusercontent.com/neo1946/neo1946.github.io/master/assets/images/6.png)

总的来说这周还是很充实的，学到了不少的东西。希望之后能继续努力！